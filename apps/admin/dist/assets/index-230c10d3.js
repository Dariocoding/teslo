import{o as Q,j as e,e as w,h as q,n as $,L as A,v as N,A as J,R as I,P as ae,c as X,a as v,f as T,r as p,t as le,ai as re,aj as oe,ak as ne,S as ee,D as B,T as te,q as ie,g as ce,s as de,Z as H,b as ue,a4 as U}from"./index-2a44fdcc.js";import{D as me}from"./DataTable-201a002f.js";import{t as g}from"./translate-b34db3f3.js";import{C as se}from"./index-883735f9.js";import{c as he}from"./capitalize-1790f93b.js";import{A as ge}from"./ActionsProducts-83f27098.js";import{T as xe}from"./TablePlaceholder-9eafa574.js";import{a as fe}from"./index.esm-e1740010.js";import{S as be}from"./index.esm-15b0778f.js";import{u as Pe}from"./useFirstLoad-6a38d6f7.js";import{D as Se,a as K}from"./DropdownItem-83b0b814.js";import{V as ve}from"./index.esm-bd6d80b9.js";import{M as Ce,L as je}from"./Lightbox-83b053f2.js";const pe=i=>{const{colors:l}=Q(),{enableClothesShopping:a}=l,n=[{field:"checkSelected",title:o=>e.jsx(we,{...o,...i}),center:!0},{title:g("products.label.image"),field:"image",center:!0},{title:g("products.label.name"),field:"titleFormatted"},null,{title:g("products.label.price"),field:"priceFormatted",center:!0},{title:g("products.label.stock"),field:"stock",center:!0},{title:g("products.label.categories"),field:"categoriesFormatted",center:!0},{title:g("products.label.brand"),field:"brandFormatted",center:!0},{title:g("products.label.providers"),field:"providersFormatted",center:!0},{title:g("products.label.status"),field:"status",center:!0},{title:g("products.label.actions"),field:"actions",center:!0}],t=[{title:g("products.label.gender"),field:"gender",center:!0},{title:g("products.label.sizes"),field:"sizesFormatted",center:!0}];return a&&n.splice(3,0,...t),n.filter(o=>o)},we=i=>{const{currentItems:l,currentItemsSelected:a,setCurrentItemsSelected:n}=i,t=a.length===l.length,o=()=>{n(t?[]:l.map(s=>s.id))};return e.jsx("div",{className:"lg:flex hidden items-center justify-center",children:e.jsx(se,{isChecked:t,onChange:o,enableMarginRight:!1})})},ye=[w.ValidRoles.ADMIN,w.ValidRoles.SUPER_USER,w.ValidRoles.SUPERVISOR],De=[w.ValidRoles.SELLER,w.ValidRoles.USER],Ee=i=>{const{products:l,currentItemsSelected:a,setCurrentItemsSelected:n,setProductImageLightBox:t}=i,o=s=>s.images.length?ae+"/product/"+s.images[s.images.length-1]:"/img/others/box.png";return l.map(s=>{var r,c;return{...s,checkSelected:e.jsx("div",{className:"hidden items-center justify-center lg:flex",children:e.jsx(se,{isChecked:a.includes(s.id),onChange:()=>a.includes(s.id)?n(a.filter(u=>u!==s.id)):n([...a,s.id]),enableMarginRight:!1})}),priceFormatted:q.format(s.price),sizesFormatted:s.sizes.join(", "),image:e.jsx("img",{onClick:()=>t(s),src:o(s),className:"lg:w-16 w-24 rounded-md mx-auto cursor-pointer transition hover:scale-110 duration-300",loading:"lazy"}),dateFormatted:$(s.dateCreated).format("DD/MM/YYYY"),gender:he(s.gender),actions:e.jsx(ge,{...i,product:s}),categoriesFormatted:(r=s.categories)!=null&&r.length?e.jsx("ul",{className:"text-xs",children:s.categories.map(u=>e.jsx("li",{children:e.jsx(A,{to:N.viewCategory.fnPath(u.idcategory),className:"link-table",children:u.title})},u.idcategory))}):null,providersFormatted:(c=s.providers)!=null&&c.length?e.jsx("ul",{className:"text-xs",children:s.providers.map(u=>e.jsxs("li",{children:[e.jsx(J,{validRoles:ye,children:e.jsx(A,{to:N.viewProvider.fnPath(u.idprovider),className:"link-table",children:u.name})}),e.jsx(J,{validRoles:De,children:u.name})]},u.idprovider))}):null,titleFormatted:e.jsxs("div",{className:"flex flex-col max-w-[110px] whitespace-pre-wrap",children:[e.jsx("div",{className:"text-sm mb-1",children:e.jsx(A,{to:N.viewProduct.fnPath(s.slug),className:"link-table",children:s.title})}),e.jsx(I,{isTrue:s.customCode,children:e.jsx("div",{className:"text-xs font-bold mb-1",children:s.customCode})}),e.jsx("div",{className:"text-xs",children:s.code})]}),brandFormatted:s.brand&&e.jsx(A,{to:N.viewBrand.fnPath(s.brand.idbrand),className:"link-table",children:s.brand.title})}})},V=i=>{const{value:l,loading:a,options:n,onChange:t,context:o,id:s,placeholder:r,title:c,customSize:u="sm:max-w-[250px]"}=i;return e.jsxs("div",{className:X("w-full",u),children:[e.jsx("label",{htmlFor:s,className:"text-xs w-full text-start mb-1 font-semibold block",children:c}),e.jsx("div",{children:e.jsx(be,{isClearable:!!o,onChange:t,options:n,primaryColor:"",value:o&&l,onSearchInputChange:()=>null,loading:a,placeholder:r,noOptionsMessage:r})})]})};function ke(i){const l=[...i];for(var a=l.length-1;a>0;a--){var n=Math.floor(Math.random()*(a+1)),t=l[a];l[a]=l[n],l[n]=t}return l}const Re=i=>{const{categories:l,providers:a,brands:n,setIsLoadingTable:t,setProducts:o,refetch:s}=i,r=Pe(),[c,u]=v.useState(),[m,j]=v.useState(),[h,E]=v.useState(),[S,P]=v.useState(null),y=l==null?void 0:l.find(d=>d.idcategory===c),k=a==null?void 0:a.find(d=>d.idprovider===m),x=n==null?void 0:n.find(d=>d.idbrand===h),z=d=>u(d==null?void 0:d.value),f=d=>j(d==null?void 0:d.value),M=d=>E(d==null?void 0:d.value),D=v.useCallback((d,b)=>[...d.sort((_,Y)=>{var F,G;return+!!((F=_.sizes)!=null&&F.find(O=>O===b||S))-+!!((G=Y.sizes)!=null&&G.find(O=>O===b||S))}).reverse()],[S]),R=d=>{const b=d==null?void 0:d.value;P(b),o(b?C=>D(C,b):C=>ke(C))},L=v.useCallback(async function(){try{t(!0);let b;if(!c&&!m&&!h){const C=await T.productsService.getAllProducts();S?b=D(C.data):b=C.data}else{const C={...m?{providerID:m}:{},...c?{categoryID:c}:{},...h?{brandID:h}:{}},_=await T.productsService.getAllByFilters(C);S?b=D(_.data):b=_.data}o(b)}catch(b){console.log(b)}finally{t(!1)}},[c,m,h,S]);return v.useEffect(()=>{r||L()},[c,m,h]),{refetchData:()=>c||m||h?L():s==null?void 0:s(),category:y,provider:k,brand:x,onChangeCategorySelect:z,onChangeBrandSelect:M,onChangeProviderSelect:f,currentSize:S,setCurrentSize:P,onChangeCurrentSize:R}},_e=i=>{const{showSelects:l=!0,loadingBrands:a,loadingCategories:n,loadingProviders:t,categories:o,brands:s,providers:r}=i,{colors:c}=Q(),{onChangeCategorySelect:u,category:m,refetchData:j,provider:h,onChangeBrandSelect:E,onChangeProviderSelect:S,brand:P,currentSize:y,onChangeCurrentSize:k}=Re(i);return p.useEffect(()=>{i.refetchData.current=j},[j]),e.jsx(I,{isTrue:l,children:e.jsxs("div",{className:"flex items-center justify-start flex-wrap w-full sm:w-auto flex-grow gap-4",children:[e.jsx(V,{id:"category-select-products",title:g("products.label.categories"),loading:n,value:{label:m==null?void 0:m.title,value:m==null?void 0:m.idcategory},options:o==null?void 0:o.map(x=>({label:x.title,value:x.idcategory})),placeholder:g("products.placeholder.categories"),context:m,onChange:u}),e.jsx(V,{id:"provider-select-products",title:g("products.label.providers"),loading:t,value:{label:h==null?void 0:h.name,value:h==null?void 0:h.idprovider},options:r==null?void 0:r.map(x=>({label:x.name,value:x.idprovider})),placeholder:g("products.placeholder.providers"),context:h,onChange:S}),e.jsx(V,{id:"brand-select-products",title:g("products.label.brand"),loading:a,value:{label:P==null?void 0:P.title,value:P==null?void 0:P.idbrand},options:s==null?void 0:s.map(x=>({label:x.title,value:x.idbrand})),placeholder:g("products.placeholder.brand"),context:P,onChange:E}),e.jsx(I,{isTrue:c.enableClothesShopping,children:e.jsx(V,{id:"sizes-select-products",title:g("products.label.sizes"),loading:!1,value:{label:y,value:y},options:w.ARRSIZES.map(x=>({value:x,label:x})),placeholder:g("products.placeholder.sizes"),context:y,onChange:k,customSize:"sm:max-w-[225px]"})})]})})},Fe=i=>{const{onCreateProduct:l,showSelects:a=!0,currenItemsSelected:n,setShowModalBarCodes:t}=i,{colors:o}=Q(),s=p.useRef();return e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-start flex-wrap pb-2 sm:flex-row flex-col sm:mb-0 mb-2",children:[e.jsxs("div",{className:X("flex items-end justify-start h-max sm:mb-0 mb-2",a&&"sm:h-[50px]"),children:[e.jsx(J,{validRoles:[w.ValidRoles.ADMIN,w.ValidRoles.SUPERVISOR,w.ValidRoles.SUPER_USER],children:e.jsx("button",{className:"btn btn-primary mb-0 btn-xs shadow-none",type:"button",onClick:l,children:e.jsx(le,{})})}),e.jsx("button",{type:"button",className:"btn btn-outline-alternative mb-0 btn-xs shadow-none",onClick:()=>s.current(),children:e.jsx(fe,{})})]}),e.jsx(_e,{...i,refetchData:s})]}),e.jsx(I,{isTrue:n.length,children:e.jsxs("div",{className:"w-full flex items-center justify-start flex-wrap pb-2 sm:flex-row flex-col sm:mb-0 mb-2 mt-3",children:[e.jsxs(Se,{classNameButton:"btn btn-xs mb-0 btn-danger mr-2 gap-1 shadow-none",displayButton:e.jsxs(e.Fragment,{children:["PDF ",e.jsx(re,{})]}),placement:"right",children:[e.jsx(K,{onClick:()=>Ne(n),children:"Export Products"}),e.jsx(K,{onClick:()=>t(!0),children:"Export Bar Codes"})]}),e.jsxs("button",{type:"button",onClick:()=>W(n,o.enableClothesShopping),className:"btn btn-xs mb-0 btn-success gap-1 shadow-none",children:["Excel ",e.jsx(oe,{})]}),e.jsxs("button",{type:"button",className:"btn btn-xs mb-0 btn-info gap-1 shadow-none",onClick:()=>W(n,o.enableClothesShopping,!0),children:["CSV ",e.jsx(ne,{})]}),e.jsxs("button",{type:"button",className:"btn btn-xs mb-0 btn-alternative gap-1 shadow-none",onClick:()=>Ie(n),children:["JSON ",e.jsx(ve,{})]})]})})]})},Ne=async i=>{const l=await T.productsService.selectProducts(i);try{ee();const a={name:"Products - "+$().format("DD/MM/YYYY"),headers:["Title","Custom Cod.","Cod.","Price","Stock","Brand","Categories","Status"],rows:l.data.map(t=>{var o;return[t==null?void 0:t.title,(t==null?void 0:t.customCode)||"",t==null?void 0:t.code.toString(),t!=null&&t.price?q.format(t==null?void 0:t.price):"0",t!=null&&t.stock?t==null?void 0:t.stock.toString():0 .toString(),((o=t==null?void 0:t.brand)==null?void 0:o.title)||"",t==null?void 0:t.categories.map(s=>s.title).join(", "),(t==null?void 0:t.status)||""]})},{baseFetchPdf:n}=await B(()=>import("./utils-52e172bf.js"),["assets/utils-52e172bf.js","assets/index-2a44fdcc.js","assets/index-57a2b61b.css"]);await n(a,"Products")}catch(a){console.log(a)}finally{te()}},W=async(i,l,a)=>{const n=await T.productsService.selectProducts(i);try{ee();const t={name:"Products - "+$().format("DD-MM-YYYY"),columns:[{header:"Title"},{header:"custom Cod."},{header:"Cod."},{header:"Price"},{header:"Stock"},{header:"Brand"},{header:"Categories"},{header:"Providers"},{header:"Status"},{header:"Description"}],data:n.data.map(r=>[r.title,r.customCode||"empty",r.code.toString(),r.price?q.format(r.price):"0",r.stock?r.stock.toString():0 .toString(),r.brand.title||"",r.categories.map(c=>c.title).join(", "),r.providers.map(c=>c.name).join(", "),r.status||"",r.description||"",l?r.gender:null,l?r.sizes.map(c=>c).join(", "):null].filter(c=>c!==null))};l&&(t.columns.push({header:"Gender"}),t.columns.push({header:"Sizes"}));const{baseFetchCsv:o,baseFetchExcel:s}=await B(()=>import("./utils-52e172bf.js"),["assets/utils-52e172bf.js","assets/index-2a44fdcc.js","assets/index-57a2b61b.css"]);a?await o(t,"Products"):await s(t,"Products")}catch(t){console.log(t)}finally{te()}},Ie=async i=>{const l=await T.productsService.selectProducts(i),{baseExportJson:a}=await B(()=>import("./utils-52e172bf.js"),["assets/utils-52e172bf.js","assets/index-2a44fdcc.js","assets/index-57a2b61b.css"]);a(l.data,"Products")},Te=v.lazy(()=>B(()=>import("./index-c1b28dc7.js"),["assets/index-c1b28dc7.js","assets/index-2a44fdcc.js","assets/index-57a2b61b.css","assets/index-7c566a6e.js","assets/formik.esm-9f82e298.js","assets/index-7661f2ba.js","assets/label-561808e2.js","assets/translate-b34db3f3.js","assets/index.esm-6d8e275a.js"])),Be=v.lazy(()=>B(()=>import("./index-51924d50.js"),["assets/index-51924d50.js","assets/index-2a44fdcc.js","assets/index-57a2b61b.css","assets/useBarCodeProduct-5f5b530e.js","assets/JsBarcode-5706d625.js","assets/index-5f7fbb69.js","assets/react-tooltip.min-0bea07f1.js","assets/react-tooltip-a01a62b5.css"])),Me=i=>{const{products:l,setProducts:a}=i,[n,t]=v.useState(!1),[o,s]=v.useState(null),[r,c]=v.useState(null),{formatMessage:u}=ie(),m=ce(),{setModal:j,closeModal:h}=de(),E=f=>{m(N.editProduct.fnPath(f.id))},S=()=>m(N.newProduct.path),P=()=>{t(!1),s(null)};return{onQuickEditProduct:f=>{function M(D){a(l.map(R=>R.id===D.id?D:R)),h()}j({title:u({id:"products.quickEdit.title"}),children:e.jsx(v.Suspense,{fallback:e.jsx(ue,{loading:!0}),children:e.jsx(Te,{product:f,onSuccess:M})}),size:"md"})},showModalDeleteProduct:n,isLoadingDeleteProduct:r,onCreateProduct:S,onDeleteProduct:f=>{t(!0),s(f)},onUpdateProduct:E,stateProductDelete:o,onAcceptDeleteProduct:async()=>{try{c(!0),await T.productsService.deleteProduct(o.id),a(l.filter(f=>f.id!==o.id)),P(),H.success(u({id:"products.deleted.success"}))}catch(f){console.log(f),H.error(f.response.data.message||"There was an error deleting the product. Please try again")}finally{c(!1)}},onCloseModalDelete:P,onViewBarCode:f=>{j({title:u({id:"products.actions.viewBarCode"}),children:e.jsx(Be,{product:f}),size:"lg"})}}},ze=p.lazy(()=>B(()=>import("./index-f565db65.js"),["assets/index-f565db65.js","assets/index-2a44fdcc.js","assets/index-57a2b61b.css","assets/MyBarCode-1a056c63.js","assets/setPrototypeOf-847c2808.js","assets/index-a6c3125b.js","assets/index-503cc3cd.js","assets/emotion-is-prop-valid.esm-9ab032ed.js","assets/index-bc927370.js","assets/unsupportedIterableToArray-cf7d0cbd.js","assets/JsBarcode-5706d625.js"])),Ke=i=>{const[l,a]=p.useState(!1),[n,t]=p.useState(!1),[o,s]=p.useState([]),[r,c]=p.useState(null),{products:u,setProducts:m,isFetching:j,refetch:h,heading:E,providers:S,categories:P,loadingCategories:y,loadingProviders:k,brands:x,loadingBrands:z,showSelects:f}=i,{onCreateProduct:M,onDeleteProduct:D,onQuickEditProduct:R,onUpdateProduct:L,showModalDeleteProduct:Z,onAcceptDeleteProduct:d,onCloseModalDelete:b,stateProductDelete:C,isLoadingDeleteProduct:_,onViewBarCode:Y}=Me(i);return e.jsxs(p.Fragment,{children:[e.jsx(me,{itemsPerPage:20,onChangePage:()=>s([]),render:F=>Ee({products:F,onDeleteProduct:D,onUpdateProduct:L,onQuickEditProduct:R,onViewBarCode:Y,currentItemsSelected:o,setCurrentItemsSelected:s,setProductImageLightBox:c}),placeholder:e.jsx(xe,{}),buttons:e.jsx(Fe,{categories:P,providers:S,refetch:h,onCreateProduct:M,loadingCategories:y,loadingProviders:k,setProducts:m,setIsLoadingTable:a,brands:x,loadingBrands:z,showSelects:f,currenItemsSelected:o,setShowModalBarCodes:t}),data:u,heading:E||pe({currentItemsSelected:o,setCurrentItemsSelected:s}),loading:j||l,showResponsive:!1}),e.jsx(Ce,{onAcceptDeleteProduct:d,onCloseModalDelete:b,showModalDeleteProduct:Z,product:C,isLoading:_}),e.jsx(I,{isTrue:n,children:e.jsx(p.Suspense,{fallback:e.jsx(e.Fragment,{}),children:e.jsx(ze,{products:u.filter(F=>o.includes(F.id)),showModal:n,onClose:()=>t(!1)})})}),e.jsx(I,{isTrue:r,children:e.jsx(je,{medium:U(r),large:U(r),small:U(r),onClose:()=>c(null),alt:r==null?void 0:r.title})})]})};export{Ke as T};

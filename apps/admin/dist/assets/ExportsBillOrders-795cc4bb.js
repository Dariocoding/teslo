import{j as s,ai as I,aj as V,ak as H,r as m,O as D,R as F,S as d,T as i,n as L,h,f as g}from"./index-5d060a31.js";import{V as G}from"./index.esm-b3530202.js";import{t as k}from"./translate-df1875a3.js";import{baseFetchPdf as v,baseFetchCsv as S,baseFetchExcel as E,baseExportJson as N}from"./utils-d8fef660.js";import{C as T}from"./index-00fee96b.js";import{c as A}from"./capitalize-1790f93b.js";import{D as p}from"./index-5a4cfb67.js";const q=n=>{const{title:o,onClickCsv:c,onClickExcel:e,onClickPdf:t,onClickJson:l}=n;return s.jsxs("div",{children:[s.jsx("h6",{className:"text-center",children:o}),n.children,s.jsxs("div",{className:"mt-2 flex flex-row flex-wrap items-start justify-center",children:[s.jsxs("button",{className:"btn btn-sm btn-danger gap-2",type:"button",onClick:()=>t(),children:["PDF ",s.jsx(I,{})]}),s.jsxs("button",{className:"btn btn-sm btn-success gap-2",type:"button",onClick:()=>e(),children:["Excel ",s.jsx(V,{})]}),s.jsxs("button",{className:"btn btn-sm btn-info gap-2",type:"button",onClick:()=>c(),children:["CSV ",s.jsx(H,{})]}),s.jsxs("button",{className:"btn btn-sm btn-alternative gap-2",type:"button",onClick:()=>l(),children:["JSON ",s.jsx(G,{})]})]})]})},$=n=>{const[o,c]=m.useState(!1),[e,t]=m.useState(!1),[l,P]=m.useState(new Date),[u,R]=m.useState(D()),[x,M]=m.useState(new Date),[f,J]=m.useState(D()),z={onClickPdf:async()=>{d();const a=await j({dateFromOrders:u,dateToOrders:l,exportAllOrders:o}),r={name:"Orders",headers:w.map(y=>y.header),rows:b(a)};await v(r,"Orders"),i()},onClickCsv:async()=>{d();const a=await j({exportAllOrders:o,dateFromOrders:u,dateToOrders:l});try{const r={name:"Orders",columns:w,data:b(a,!1)};await S(r,"Orders")}catch(r){console.log(r)}finally{i()}},onClickExcel:async()=>{d();const a=await j({exportAllOrders:o,dateFromOrders:u,dateToOrders:l});try{console.log({orders:b(a),orders2:a});const r={name:"Orders",columns:w,data:b(a)};await E(r,"Orders")}catch(r){console.log(r)}finally{i()}},onClickJson:async()=>{const a=await j({exportAllOrders:o,dateFromOrders:u,dateToOrders:l});N(a,"Orders"),i()}},Y={onClickPdf:async()=>{d();const a=await C({dateFromBills:f,dateToBills:x,exportAllBills:e}),r={name:"Bills",headers:O.map(y=>y.header),rows:B(a)};await v(r,"Bills"),i()},onClickCsv:async()=>{d();const a=await C({exportAllBills:e,dateFromBills:f,dateToBills:x});try{const r={name:"Bills",columns:O,data:B(a,!1).pop()};await S(r,"Bills")}catch(r){console.log(r)}finally{i()}},onClickExcel:async()=>{d();const a=await C({exportAllBills:e,dateFromBills:f,dateToBills:x});try{const r={name:"Bills",columns:O,data:B(a)};await E(r,"Bills")}catch(r){console.log(r)}finally{i()}},onClickJson:async()=>{const a=await C({exportAllBills:e,dateFromBills:f,dateToBills:x});N(a,"Bills"),i()}};return s.jsxs(m.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[s.jsx(T,{isChecked:o,onChange:c,children:s.jsx("span",{className:"text-sm",children:"Export all Orders"})}),s.jsx(T,{isChecked:e,onChange:t,children:s.jsx("span",{className:"text-sm",children:"Export all Bills"})})]}),s.jsx("span",{children:s.jsx(q,{title:k("orders.title"),...z,children:s.jsx(F,{isTrue:!o,children:s.jsxs("div",{className:"flex gap-2 items-start mt-2 pb-3",children:[s.jsx(p,{value:u,placeholder:"From",borderRadius:"semi-square",size:"small",maxDate:new Date,onChange:a=>R(a),label:"From",labelAlignment:"left"}),s.jsx(p,{value:l,placeholder:"From",borderRadius:"semi-square",size:"small",maxDate:new Date,onChange:a=>P(a),label:"To",labelAlignment:"left"})]})})})}),s.jsx("span",{children:s.jsx(q,{title:k("bills.title"),...Y,children:s.jsx(F,{isTrue:!e,children:s.jsxs("div",{className:"flex gap-2 items-start mt-2 pb-3",children:[s.jsx(p,{value:f,placeholder:"From",borderRadius:"semi-square",size:"small",maxDate:new Date,onChange:a=>J(a),label:"From",labelAlignment:"left"}),s.jsx(p,{value:x,placeholder:"To",borderRadius:"semi-square",size:"small",maxDate:new Date,onChange:a=>M(a),label:"Start",labelAlignment:"left"})]})})})})]})},w=[{header:"Customer"},{header:"Payment Method"},{header:"Reference"},{header:"Status"},{header:"Date"},{header:"Total"}],b=(n,o=!0)=>{const c=n.map(e=>{var t,l;return[e.user?((t=e.user)==null?void 0:t.firstName)+" "+((l=e.user)==null?void 0:l.lastName):"",e.paymentMethod.title,e.reference,A(e.status),L(e.dateCreated).format("DD/MM/YYYY HH:mm:ss"),h.format(e.total)]});return o&&c.push(["","","","","",h.format(n.reduce((e,t)=>e+t.total,0))]),c},j=async n=>{const{dateFromOrders:o,exportAllOrders:c,dateToOrders:e}=n;let t;d();try{return c?t=(await g.ordersService.getOrders()).data:t=(await g.ordersService.getOrders({from:o,to:e})).data,t}catch(l){console.log(l),i()}return[]},O=[{header:"Reference"},{header:"Status"},{header:"Provider Name"},{header:"Subtotal"},{header:"Total"}],B=(n,o=!0)=>{const c=n.map(e=>[e.reference,A(e.status),e.provider.name,h.format(e.subtotal),h.format(e.total)]);return o&&c.push(["","","",h.format(n.reduce((e,t)=>e+t.subtotal,0)),h.format(n.reduce((e,t)=>e+t.total,0))]),c},C=async n=>{const{exportAllBills:o,dateFromBills:c,dateToBills:e}=n;let t;d();try{return o?t=(await g.billsService.findBills({})).data:t=(await g.billsService.findBills({from:c,to:e})).data,t}catch(l){console.log(l),i()}return[]};export{$ as E,q as I,w as c,b as g};

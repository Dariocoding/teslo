import{j as s,r as L,R as g,e as c,o as M,q as k,J as C,Z as x,c as P,f as E}from"./index-2a44fdcc.js";import{B as Y}from"./index-7c566a6e.js";import{I as m}from"./index-7661f2ba.js";import{S as V}from"./index-1b687f3c.js";import{A as $}from"./index-f273d7cd.js";import{F as B,a as D}from"./formik.esm-9f82e298.js";import{c as O,a as d}from"./index.esm-6d8e275a.js";import{u as z}from"./useTimeOutMessage-2bcc922e.js";import{t as r}from"./translate-b34db3f3.js";import{c as J}from"./capitalize-1790f93b.js";import"./react-paginate-2e6e26f6.js";import"./index-b897be0f.js";import"./react-tooltip.min-0bea07f1.js";/* empty css                */import"./label-561808e2.js";import"./index.esm-15b0778f.js";import"./styled-components.browser.esm-2c93ef95.js";import"./emotion-is-prop-valid.esm-9ab032ed.js";import"./emotion-unitless.esm-475d8cc4.js";import"./index.esm-692625f4.js";import"./index-68678f62.js";import"./motion-710a2f4c.js";import"./index-503cc3cd.js";const W=u=>{const{renderRoles:a}=u;return s.jsx(L.Fragment,{children:s.jsx(g,{isTrue:a,children:s.jsx(V,{multiple:!0,name:"roles",options:[{value:c.ValidRoles.ADMIN,label:r("users.admin")},{value:c.ValidRoles.SUPERVISOR,label:r("users.supervisor")},{value:c.ValidRoles.SELLER,label:r("users.seller")},{value:c.ValidRoles.USER,label:r("users.customer")}],onChange:(l,e)=>{if(!l)return e;const p=[...l];return p.length===2&&p.shift(),p.map(b=>b.value)}})})})},fe=u=>{var S;const{onSuccess:a,defaultValidRole:l=[c.ValidRoles.USER],user:e,fullWidthDni:p,renderRoles:b=!0,dniValidate:h=!1}=u,{colors:R}=M(),n=e?"update":"create",{formatMessage:o}=k(),{configEnterprise:N}=C(),[w,j]=z(5e3);!((S=N.prefixes)!=null&&S.length)&&R.enablePrefixesUser&&x.error("You have no prefixes configured!, please configure them manually");const I={firstName:(e==null?void 0:e.firstName)||"",lastName:(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||"",...(e==null?void 0:e.password)&&{password:e==null?void 0:e.password},isActive:(e==null?void 0:e.isActive)??!0,roles:(e==null?void 0:e.roles)||l,prefix:(e==null?void 0:e.prefix)||N.prefixes[0],dni:(e==null?void 0:e.dni)||""},A=async i=>{var f,q;try{if(!y(i))i.prefix=null,i.dni=null;else if(!i.dni.trim()){x.error(o({id:"users.error.dni.empty"}));return}let t;n==="create"?(t=await E.usersService.createUser(i),x.success(o({id:"users.add.success"}))):n==="update"&&(t=await E.usersService.updateUser(e.iduser,i),x.success(o({id:"users.edit.success"}))),a&&a(t.data)}catch(t){console.log(t);const v=(q=(f=t.response)==null?void 0:f.data)==null?void 0:q.message;v.includes("Ya existe la llave (email)")?j(o({id:"users.error.email.alreadyExist"})):v.includes("Ya existe la llave (dni)")?j(o({id:"users.error.dni.alreadyExist"})):j(t.response.data.message||o(n==="create"?{id:"users.add.error"}:{id:"users.edit.error"}))}};console.log({dniValidate:h});const F=O({firstName:d().required(r("users.error.firstName.required")),lastName:d().required(r("users.error.lastName.required")),email:d().required(r("users.error.email.required")).email(r("users.error.email.invalid")),...n==="create"&&{password:d().required(r("users.error.password.required")).min(6,r("users.error.password.invalidLength"))},...n==="update"&&{password:d().min(6,r("users.error.password.invalidLength"))},...h&&{dni:d().required(r("users.error.dni.empty"))}});return s.jsx(B,{initialValues:I,onSubmit:A,validationSchema:F,children:({values:i})=>s.jsxs(D,{children:[s.jsx(g,{isTrue:w,children:s.jsx($,{type:"danger",className:"mb-6",children:w})}),s.jsx(g,{isTrue:y(i),children:s.jsx("div",{className:P(!p&&"grid lg:grid-cols-4 lg:gap-4"),children:s.jsx("div",{className:"lg:col-span-3",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(g,{isTrue:R.enablePrefixesUser,children:s.jsx(V,{options:N.prefixes.map(f=>({label:J(f),value:f})),name:"prefix",label:r("users.label.prefix"),className:"mr-1.5"})}),s.jsx(m,{label:r("users.label.dni"),name:"dni",placeholder:r("users.placeholder.dni"),required:!0,className:"w-full",showError:h,showSuccess:h})]})})})}),s.jsxs("div",{className:"grid lg:grid-cols-2 lg:gap-4",children:[s.jsx(m,{label:r("users.label.firstName"),name:"firstName",placeholder:r("users.placeholder.firstName"),required:!0}),s.jsx(m,{label:r("users.label.lastName"),name:"lastName",placeholder:r("users.placeholder.lastName"),required:!0})]}),s.jsx(m,{label:r("users.label.email"),name:"email",placeholder:r("users.placeholder.email"),required:!0}),s.jsx(m,{label:r("users.label.phone"),name:"phone",placeholder:r("users.placeholder.phone")}),s.jsx(m,{type:"password",label:r("users.label.password"),name:"password",required:!0,placeholder:r("users.placeholder.password")}),s.jsx(W,{renderRoles:b}),s.jsx(Y,{full:!0,className:"btn-primary btn-sm",children:n==="create"?r("users.add"):r("users.edit")})]})})},y=u=>{var a,l;return(l=(a=u.roles)==null?void 0:a.includes)==null?void 0:l.call(a,c.ValidRoles.USER)};export{fe as default,y as includesRolUser};

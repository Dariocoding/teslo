import{f as M,O as L,r as p,j as e,ag as B,A as F,e as y,k as U,l as q,m as $,c as N,q as R,_ as x,D as H,t as z,R as O,p as S}from"./index-5d060a31.js";import{H as G}from"./index-dddff9b7.js";import{u as K}from"./useQueryState-744f060d.js";import{T as Q}from"./index-7588abf3.js";import{u as W}from"./useFirstLoad-85bc81b4.js";import{D as J}from"./DataTable-880fcb59.js";import{a as X}from"./index.esm-68a1f323.js";import{u as Y}from"./useFetchPaymentMethods-bb78b578.js";import{t as a}from"./translate-df1875a3.js";import{T as Z}from"./TablePlaceholder-02f29929.js";import{B as ee}from"./index-a6ad04c6.js";import{I as f}from"./index-830e2dd2.js";import{u as te,g as se,F as ae,a as ne}from"./formik.esm-d4024a5f.js";import{L as oe}from"./label-4820e3e3.js";import{G as le}from"./switch-09b77e93.js";import{c as re,a as ie}from"./index.esm-27ddb6fd.js";import{a as de}from"./index.esm-f872f87b.js";import"./index-bb9c84f2.js";import"./emotion-is-prop-valid.esm-9ab032ed.js";import"./index-7167fa41.js";import"./ActionsTableOrder-e3e2ab6b.js";import"./DropdownItem-83d8cdee.js";import"./useMedia-235a01df.js";import"./BadgeStatusOrder-a9ca6b7d.js";import"./capitalize-1790f93b.js";import"./index-5a4cfb67.js";import"./getPrototypeOf-b9d135b5.js";import"./setPrototypeOf-6cb8dd5e.js";import"./unsupportedIterableToArray-cf7d0cbd.js";import"./zIndex-e43e5c8e.js";import"./slicedToArray-efe1abbd.js";import"./index.esm-b3530202.js";import"./utils-d8fef660.js";import"./ExportsBillOrders-795cc4bb.js";import"./index-00fee96b.js";import"./sweetalert2.all-8c6828e1.js";import"./react-paginate-3ebe4213.js";import"./hidden-36975b35.js";async function ce(o){const{data:s}=await M.ordersService.getOrdersByPaymentMethod(o.queryKey[1],{from:L(),to:new Date});return s}function me(o){return K(["orders-by-payment",o],ce,[])}const he=o=>{const{id:s,setId:t}=o,l=W(),{refetch:r,data:d,setData:c,isFetching:i}=me(s);return p.useEffect(()=>{s&&!l&&r()},[s]),e.jsx("div",{className:"tile",children:e.jsx(Q,{orders:d,setOrders:c,refetch:r,isFetching:i,showSelects:!0,buttons:e.jsx("button",{type:"button",onClick:()=>t(null),className:"btn btn-xs btn-danger mb-0",children:e.jsx(B,{})}),fetchOrders:m=>M.ordersService.getOrdersByPaymentMethod(s,m),navigateOnChageDateSelect:!1})})},pe=()=>[{title:"ID",field:"idpaymentmethod",center:!0},{title:a("paymentMethods.label.name"),field:"title",center:!0},{title:a("paymentMethods.label.owner"),field:"owner",center:!0},{title:a("paymentMethods.label.DNI"),field:"dni",center:!0},{title:a("paymentMethods.label.email"),field:"email",center:!0},{title:a("paymentMethods.label.actions"),field:"actions",center:!0}],ue=o=>{const{paymentMethod:s,deletePaymentMethod:t,updatePaymentMethod:l,setViewOrdersByPaymentMethod:r}=o,d=()=>t(s),c=()=>l(s),i=()=>r(s);return e.jsx(F,{validRoles:[y.ValidRoles.ADMIN,y.ValidRoles.SUPER_USER,y.ValidRoles.SUPERVISOR],children:e.jsxs("div",{className:"grid grid-cols-2 w-20 mx-auto lg:w-28",children:[e.jsx("button",{className:"btn btn-success btn-xs",onClick:i,children:e.jsx(U,{})}),e.jsx("button",{className:"btn btn-primary btn-xs",onClick:c,children:e.jsx(q,{})}),e.jsx("button",{className:"btn btn-danger btn-xs col-span-2",onClick:d,children:e.jsx($,{})})]})})},ye=o=>{const{name:s,className:t,label:l,classNameLabel:r}=o,{values:d,setFieldValue:c}=te(),i=se(d,s),m=()=>{c(s,!i)};return e.jsxs("div",{className:N("form-group",t),children:[e.jsx(oe,{className:r,children:l}),e.jsx(le,{checked:i,onChange:m,className:`${i?"bg-blue-600":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:e.jsx("span",{className:`${i?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition`})})]})},be=re({title:ie().required("Name is required")}),fe=o=>{const{state:s,paymentMethod:t,onSuccess:l}=o,{formatMessage:r}=R(),d={title:(t==null?void 0:t.title)||"",owner:(t==null?void 0:t.owner)||"",phone:(t==null?void 0:t.phone)||"",email:(t==null?void 0:t.email)||"",dni:(t==null?void 0:t.dni)||"",visible:(t==null?void 0:t.visible)??!0};async function c(i,m){try{let h;if(s==="create"){h=await M.paymentMethodService.createOne(i);const b=r({id:"paymentMethods.add.success"});x.success(b),m.resetForm()}else if(s==="update"){h=await M.paymentMethodService.updateOne(t.idpaymentmethod,i);const b=r({id:"paymentMethods.edit.success"});x.success(b)}l==null||l(h.data)}catch(h){console.log(h),x.error("There was an error setting the payment method")}}return e.jsx(ae,{initialValues:d,onSubmit:c,enableReinitialize:!0,validationSchema:be,children:e.jsxs(ne,{children:[e.jsx(f,{label:a("paymentMethods.label.name"),name:"title",placeholder:a("paymentMethods.placeholder.name")}),e.jsx(f,{label:a("paymentMethods.label.owner"),name:"owner",placeholder:a("paymentMethods.placeholder.owner")}),e.jsx(f,{label:a("paymentMethods.label.phone"),name:"phone",placeholder:a("paymentMethods.placeholder.phone")}),e.jsx(f,{label:a("paymentMethods.label.email"),name:"email",placeholder:a("paymentMethods.placeholder.email")}),e.jsx(f,{label:a("paymentMethods.label.DNI"),name:"dni",placeholder:a("paymentMethods.placeholder.DNI")}),e.jsx(ye,{name:"visible",label:"Visible",className:"font-bold"}),e.jsx(ee,{className:N("btn-sm",s==="create"&&"btn-primary",s==="update"&&"btn-danger"),full:!0,children:r({id:s==="create"?"paymentMethods.add.title":"paymentMethods.edit.title"})})]})})},xe=o=>{const{status:s,onSuccessForm:t,tempPaymentMethod:l}=o;return e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:N("tile mb-0 rounded-b-none text-white py-3",s==="create"&&"bg-blue-600",s==="update"&&"bg-red-600"),children:e.jsx("h6",{children:a(s==="create"?"paymentMethods.add.title":"paymentMethods.edit.title")})}),e.jsx("div",{className:"tile rounded-t-none",children:e.jsx(fe,{state:s,onSuccess:t,paymentMethod:l})})]})},Me=p.lazy(()=>H(()=>import("./ModalDeletePaymentMethod-34f018f6.js"),["assets/ModalDeletePaymentMethod-34f018f6.js","assets/index-5d060a31.js","assets/index-57a2b61b.css","assets/ConfirmModal-61bf492c.js","assets/translate-df1875a3.js"])),je=o=>{const{heading:s=pe(),setSelected:t}=o,{formatMessage:l}=R(),[r,d]=p.useState("create"),[c,i]=p.useState(null),[m,h]=p.useState(!1),[b,v]=p.useState(!1),[g,w]=p.useState(null),{isFetching:I,data:j,setData:P,refetch:k}=Y();function T(n){r==="create"?P([n,...j]):r==="update"&&P(j.map(u=>u.idpaymentmethod===n.idpaymentmethod?{...n}:u))}function V(n){h(!0),w(n)}function D(){h(!1),w(null)}async function E(){try{v(!0),await M.paymentMethodService.deleteOne(g.idpaymentmethod),P(j.filter(u=>u.idpaymentmethod!==g.idpaymentmethod)),D();const n=l({id:"paymentMethods.deleted.success"});x.success(n)}catch(n){console.log(n);const u=l({id:"paymentMethods.deleted.error"});x.error(n.response.data.message||u)}finally{v(!1)}}function C(n){i(n),d("update")}function _(){i(null),d("create")}function A(n){t(n.idpaymentmethod)}return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-4",children:[e.jsx("div",{className:"lg:col-span-3 overflow-x-auto",children:e.jsx("div",{className:"tile",children:e.jsx(J,{placeholder:e.jsx(Z,{}),buttons:e.jsx(F,{validRoles:[y.ValidRoles.ADMIN,y.ValidRoles.SUPER_USER,y.ValidRoles.SUPERVISOR],children:e.jsxs("div",{className:"flex items-center justify-start",children:[e.jsx("button",{className:"btn btn-primary btn-xs",onClick:_,children:e.jsx(z,{})}),e.jsx("button",{className:"btn btn-outline-alternative btn-xs",onClick:()=>k(),children:e.jsx(X,{})})]})}),loading:I,data:j.map(n=>({...n,actions:e.jsx(ue,{paymentMethod:n,deletePaymentMethod:V,setViewOrdersByPaymentMethod:A,updatePaymentMethod:C})})),heading:s})})}),e.jsx(xe,{status:r,onSuccessForm:T,tempPaymentMethod:c}),e.jsx(O,{isTrue:m,children:e.jsx(Me,{onAcceptDeletePaymentMethod:E,onCloseModalDelete:D,isLoading:b,showModalDeletePaymentMethod:m,paymentMethod:g})})]})},ot=o=>{const[s,t]=p.useState(null);return e.jsxs(G,{title:a("paymentMethods.title"),icon:e.jsx(de,{}),to:S.settings.path,breadcrumbs:[{label:a("dashboard.title"),to:S.dashboard.path},{label:a("settings.title"),to:S.settings.path},{label:a("paymentMethods.title")}],children:[e.jsx(je,{setSelected:t}),e.jsx(O,{isTrue:s,children:e.jsx(he,{id:s,setId:t})})]})};export{ot as default};

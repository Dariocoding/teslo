import{g as D,K as S,r as x,O as y,n as f,Z as C,f as g,v as b,ah as N,j as t,L as j,t as T,R as v,d as P,as as k,q as Y,h,e as H}from"./index-5d060a31.js";import{H as L}from"./index-dddff9b7.js";import{a as O}from"./index.esm-ca75a173.js";import{T as R}from"./TablePlaceholder-02f29929.js";import{D as I}from"./DataTable-880fcb59.js";import{t as a}from"./translate-df1875a3.js";import{a as M}from"./index.esm-68a1f323.js";import{D as B}from"./index-5a4cfb67.js";import{B as E}from"./BadgeStatusOrder-a9ca6b7d.js";import{T as q}from"./index.esm-e9c774ce.js";import{k as A}from"./index.esm-8c897c47.js";import{S as F}from"./sweetalert2.all-8c6828e1.js";import{u as U}from"./useQueryState-744f060d.js";import"./index-bb9c84f2.js";import"./emotion-is-prop-valid.esm-9ab032ed.js";import"./index-7167fa41.js";import"./formik.esm-d4024a5f.js";import"./react-paginate-3ebe4213.js";import"./useMedia-235a01df.js";import"./getPrototypeOf-b9d135b5.js";import"./setPrototypeOf-6cb8dd5e.js";import"./unsupportedIterableToArray-cf7d0cbd.js";import"./zIndex-e43e5c8e.js";import"./slicedToArray-efe1abbd.js";import"./capitalize-1790f93b.js";const z=()=>[{title:a("bills.label.ID"),field:"idbill",center:!0},{title:a("bills.label.reference"),field:"reference",center:!0},{title:a("bills.label.subtotal"),field:"subtotalFormatted",center:!0},{title:a("bills.label.tax"),field:"taxFormatted",center:!0},{title:a("bills.label.deliveryPrice"),field:"deliveryFormatted",center:!0},{title:a("bills.label.total"),field:"totalFormatted",center:!0},{title:a("bills.label.status"),field:"statusFormatted",center:!0},{title:a("bills.label.dateCreated"),field:"dateCreatedFormatted",center:!0},{title:a("bills.label.dateUpdated"),field:"dateUpdatedFormatted",center:!0},{title:a("bills.label.actions"),field:"actions",center:!0}],$=l=>{const{showSelects:s,setIsLoadingTable:n,setBills:c}=l,m=D(),[r]=S(),[i,p]=x.useState(r.get("from")?new Date(r.get("from")):y()),[d,o]=x.useState(r.get("to")?new Date(r.get("to")):new Date),u=x.useCallback(async()=>{try{if(f(i).isAfter(f(d))||f(d).isBefore(f(i)))return C.error("The date range is invalid");n(!0);const e=await g.billsService.findBills({from:i,to:d});m({pathname:b.bills.path,search:N({from:i.toISOString(),to:d.toISOString()}).toString()}),c(e.data)}catch(e){console.log(e)}finally{n(!1)}},[i,d]);return t.jsxs("div",{className:"w-full flex items-center justify-start flex-wrap pb-2 sm:flex-row flex-col sm:mb-0 mb-2",children:[t.jsxs("div",{className:"flex items-end justify-start sm:h-[50px] sm:mb-0 mb-2",children:[t.jsx(j,{to:b.newBill.path,className:"btn btn-primary btn-xs mb-0",children:t.jsx(T,{})}),t.jsx(v,{isTrue:s,children:t.jsx("button",{className:"btn btn-alternative btn-xs mb-0",onClick:u,children:t.jsx(M,{})})})]}),t.jsx(v,{isTrue:s,children:t.jsxs("div",{className:"flex items-center justify-start flex-wrap w-full sm:w-auto flex-grow gap-4",children:[t.jsxs("div",{className:"w-full sm:max-w-[225px]",children:[t.jsx("label",{htmlFor:"category-select-products",className:"text-xs w-full text-start mb-1 font-semibold block",children:a("app.from")}),t.jsx("div",{children:t.jsx(B,{value:i,borderRadius:"semi-square",size:"small",maxDate:new Date,onChange:e=>p(e)})})]}),t.jsxs("div",{className:"w-full sm:max-w-[225px]",children:[t.jsx("label",{htmlFor:"category-select-products",className:"text-xs w-full text-start mb-1 font-semibold block",children:a("app.to")}),t.jsx("div",{children:t.jsx(B,{value:d,borderRadius:"semi-square",size:"small",maxDate:new Date,onChange:e=>o(e)})})]}),t.jsx("div",{className:"flex items-end sm:h-[50px]",children:t.jsx("button",{className:"btn btn-xs btn-success mb-0",type:"button",onClick:u,children:t.jsx(P,{})})})]})})]})},K=l=>{const{bill:s,onCancelBill:n}=l,c=s.status==="cancelled",m=()=>n(s);return t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(j,{to:b.viewBill.fnPath(s.idbill),className:"btn btn-sm btn-success px-2.5",children:t.jsx(A,{})}),t.jsx(j,{to:b.editBill.fnPath(s.idbill),className:"btn btn-sm btn-info px-2.5",children:t.jsx(k,{})}),t.jsx("button",{className:"btn btn-sm btn-danger px-2 py-1.5",disabled:c,onClick:m,children:t.jsx(q,{className:"text-lg"})})]})},Q=l=>{const{bills:s,setBills:n,isLoading:c,showSelects:m=!0}=l,{formatMessage:r}=Y(),[i,p]=x.useState(!1),d=o=>{F.fire({title:r({id:"bills.delete.youSure"}),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No",reverseButtons:!0}).then(async u=>{if(u.isConfirmed){const e=await g.billsService.updateBill(o.idbill,{status:H.ValidStatusOrder.CANCELED});n(s.map(w=>w.idbill===o.idbill?{...e.data}:w)),F.fire(r({id:"app.canceled"}),r({id:"bills.delete.success"}),"success")}})};return t.jsx(I,{itemsPerPage:20,buttons:t.jsx($,{setBills:n,setIsLoadingTable:p,showSelects:m}),data:s,render:o=>{var u;return(u=o==null?void 0:o.map)==null?void 0:u.call(o,e=>({...e,dateCreatedFormatted:f(e.dateCreated).format("DD/MM/YYYY HH:mm"),dateUpdatedFormatted:f(e.dateUpdated).format("DD/MM/YYYY HH:mm"),taxFormatted:`${e.tax||0}%`,subtotalFormatted:h.format(e.subtotal||0),totalFormatted:h.format(e.total||0),statusFormatted:t.jsx(E,{status:e.status}),deliveryFormatted:h.format(e.delivery||0),actions:t.jsx(K,{bill:e,onCancelBill:d})}))},showResponsive:!1,heading:z(),placeholder:t.jsx(R,{}),loading:c||i})};async function V(l){const{data:s}=await g.billsService.findBills(l.from&&l.to?{from:l.from,to:l.to}:void 0);return s}function Z(l){return U(["bills"],s=>V({...s,...l?{...l}:{}}),[])}const wt=l=>{const[s]=S(),n=s.get("from")||y(),c=s.get("to")||new Date,{data:m,setData:r,isLoading:i}=Z({from:n,to:c});return t.jsx(L,{to:b.dashboard.path,breadcrumbs:[{label:a("dashboard.title"),to:b.dashboard.path},{label:a("bills.title")}],icon:t.jsx(O,{}),title:a("bills.title"),children:t.jsx("div",{className:"tile",children:t.jsx(Q,{bills:m,setBills:r,isLoading:i})})})};export{wt as default};

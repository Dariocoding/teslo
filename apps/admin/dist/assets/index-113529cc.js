import{u as T,e as t,j as l,r,L as N,p as w,k as O,R as c,l as _,A as Y,m as z,n as q,v as H,o as $,q as B,s as M,t as G,f as J,_ as K}from"./index-5d060a31.js";import{D as Q}from"./DataTable-880fcb59.js";import{a as W}from"./index.esm-68a1f323.js";import{g as X}from"./getMaximiumRol-ab834d09.js";import{T as Z}from"./TablePlaceholder-02f29929.js";import{t as n}from"./translate-df1875a3.js";import{S as ee}from"./sweetalert2.all-8c6828e1.js";import C from"./FormUser-ef302a8b.js";import{M as se}from"./ModalDeleteUser-9ac860d3.js";const le=i=>{var f;const{user:e,onUpdateUser:d,onDeleteUser:o}=i,{user:s}=T(),m=()=>d(e),R=()=>o(e),x=(e.iduser!==s.iduser&&(((e==null?void 0:e.roles.includes(t.ValidRoles.SUPER_USER))||(e==null?void 0:e.roles.includes(t.ValidRoles.ADMIN))||(e==null?void 0:e.roles.includes(t.ValidRoles.SUPERVISOR))||(e==null?void 0:e.roles.includes(t.ValidRoles.SELLER)))&&((f=s==null?void 0:s.roles)==null?void 0:f.includes(t.ValidRoles.SUPER_USER))||((e==null?void 0:e.roles.includes(t.ValidRoles.ADMIN))||(e==null?void 0:e.roles.includes(t.ValidRoles.SUPERVISOR))||(e==null?void 0:e.roles.includes(t.ValidRoles.SELLER)))&&(s==null?void 0:s.roles.includes(t.ValidRoles.ADMIN))||((e==null?void 0:e.roles.includes(t.ValidRoles.SUPERVISOR))||(e==null?void 0:e.roles.includes(t.ValidRoles.SELLER)))&&(s==null?void 0:s.roles.includes(t.ValidRoles.SUPERVISOR)))||(e==null?void 0:e.roles.includes(t.ValidRoles.USER)))&&!(e!=null&&e.roles.includes(t.ValidRoles.SUPER_USER));return l.jsxs(r.Fragment,{children:[l.jsx(N,{to:w.viewUser.fnPath(e.iduser),className:"btn btn-success btn-xs",children:l.jsx(O,{})}),l.jsxs(c,{isTrue:x,children:[l.jsx("button",{className:"btn btn-primary btn-xs",onClick:m,children:l.jsx(_,{})}),l.jsx(Y,{validRoles:[t.ValidRoles.ADMIN,t.ValidRoles.SUPERVISOR,t.ValidRoles.SUPER_USER],children:l.jsx("button",{className:"btn btn-danger btn-xs",onClick:R,children:l.jsx(z,{})})})]})]})},te=i=>{const{users:e,config:d}=i,{enablePrefixesUser:o}=d||{};return e.map(s=>({...s,isActiveFormatted:null,actions:l.jsx(le,{user:s,...i}),userRol:X(s==null?void 0:s.roles),dateCreatedFormatted:q(s.dateCreated).format("DD/MM/YYYY"),fullName:l.jsx(N,{to:H.viewUser.fnPath(s.iduser),className:"link-table",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)}),dniFormatted:s!=null&&s.roles.includes(t.ValidRoles.USER)?(s.prefix&&o?s.prefix+" ":"")+s.dni:""}))},ae=i=>{let e=[{title:n("users.label.fullName"),field:"fullName"},{title:n("users.label.email"),field:"email"},{title:n("users.label.phone"),field:"phone"},{title:n("users.label.dateCreated"),field:"dateCreatedFormatted",center:!0},{title:n("users.label.actions"),field:"actions",center:!0}];return i?e=[{title:n("users.label.dni"),field:"dniFormatted"},...e]:e=[{title:n("users.label.ID"),field:"iduser"},...e],e},ue=i=>{const{isFetching:e,setUsers:d,users:o,refetch:s,validRol:m,showCreate:R=!0,showPagination:x,showSearch:f,showResponsive:y=!0}=i,{colors:F}=$(),{formatMessage:u}=B(),b=M(a=>a.setModal),j=M(a=>a.closeModal),[p,g]=r.useState(!1),[h,E]=r.useState(null),[A,V]=r.useState(!1);async function I(){function a(S){d([S,...o]),j()}b({title:u({id:"users.add"}),children:l.jsx(r.Suspense,{fallback:l.jsx(l.Fragment,{}),children:l.jsx(C,{onSuccess:a,defaultValidRole:[m]})}),size:"md"})}async function k(a){g(!0),E(a)}async function v(a){function S(P){d(o.map(U=>U.iduser===P.iduser?{...U,...P}:U)),j()}b({title:u({id:"users.edit"}),children:l.jsx(C,{user:a,onSuccess:S}),size:"md"})}const D=()=>{g(!1),E(null)},L=async()=>{try{V(!0),await J.usersService.deleteUser(h.iduser),d(o.filter(a=>a.iduser!==h.iduser)),D(),ee.fire(u({id:"users.deleted.success"}),"","success")}catch(a){console.log(a),K.error(a.response.data.message||u({id:"users.deleted.error"}))}finally{V(!1)}};return l.jsxs(l.Fragment,{children:[l.jsx(Q,{itemsPerPage:20,showResponsive:y,placeholder:l.jsx(Z,{}),buttons:l.jsx(c,{isTrue:R||s,children:l.jsxs("div",{className:"flex items-center justify-start",children:[l.jsx(c,{isTrue:R,children:l.jsx("button",{title:n("users.add"),className:"btn btn-primary btn-xs",onClick:I,children:l.jsx(G,{})})}),l.jsx(c,{isTrue:s,children:l.jsx("button",{className:"btn btn-outline-alternative btn-xs",onClick:s,children:l.jsx(W,{})})})]})}),data:o,heading:i.heading||ae(m==="user"),loading:e,showPagination:x,showSearch:f,render:a=>te({users:a,onDeleteUser:k,onUpdateUser:v,config:F})}),l.jsx(c,{isTrue:p,children:l.jsx(se,{isLoading:A,user:h,showModalDeleteUser:p,onAcceptDeleteUser:L,onCloseModalDelete:D})})]})};export{ue as T};

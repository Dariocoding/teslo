import{j as e,r as R,R as p,o as j,c as i,a as l,D,u as U,q as E,s as P,g as _,f as w,e as M,_ as $,v as q}from"./index-5d060a31.js";import{A as B}from"./index-da22cc52.js";import{F as V,a as O}from"./formik.esm-d4024a5f.js";import{B as z}from"./index-a6ad04c6.js";import{I as v}from"./index-830e2dd2.js";import{C as G}from"./index-00fee96b.js";import{t as n}from"./translate-df1875a3.js";import{A as X}from"./index-b5d70441.js";import{d as H}from"./index.esm-68a1f323.js";import{b as J}from"./index.esm-fddd0dd0.js";import{R as b}from"./index-7167fa41.js";import{u as K}from"./useTimeOutMessage-1f33819f.js";import{c as Q,a as L}from"./index.esm-27ddb6fd.js";import"./styled-components.browser.esm-b73f4f45.js";import"./emotion-is-prop-valid.esm-9ab032ed.js";import"./emotion-unitless.esm-475d8cc4.js";import"./index-08f0451d.js";import"./label-4820e3e3.js";import"./index.esm-8c897c47.js";import"./index-4c77f7f5.js";import"./motion-489fcba6.js";import"./index-bb9c84f2.js";const W=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Y(o){return typeof o=="string"&&W.test(o)}const Z=o=>{const{loading:s,message:t}=o;return e.jsxs(R.Fragment,{children:[e.jsx(p,{isTrue:s,children:e.jsx("div",{className:"flex items-center justify-center absolute w-full h-full top-0 left-0 z-10 bg-white bg-opacity-10 backdrop-filter backdrop-blur-[2px] rounded-lg",children:e.jsx(H,{className:"text-2xl w-12 h-12 text-black animate-spin"})})}),e.jsx(p,{isTrue:t,children:e.jsx(X,{type:"danger",className:"mb-4 text-sm",title:n("login.error.errorAuth"),children:t})})]})},ee=o=>{const{userRemember:s}=o,{colors:t}=j();return e.jsx(b,{isTrue:s,children:e.jsxs("div",{className:"form-group",children:[e.jsx("div",{className:"flex items-center justify-center mb-1 mt-2",children:e.jsx(J,{className:i('"text-xl',t.isThemed&&t.isThemeDarkLogin&&"text-white")})}),e.jsx("h6",{className:i("text-sm text-center",t.isThemed&&t.isThemeDarkLogin&&"text-gray-100"),children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)}),e.jsx("p",{className:i(t.isThemeDarkLogin&&t.isThemed&&"text-gray-100","text-xs text-center mt-0"),children:s==null?void 0:s.email})]})})},se=()=>localStorage.getItem("userRemember"),re=o=>{localStorage.setItem("userRemember",o.iduser)},te=()=>localStorage.removeItem("userRemember"),ae=o=>{const{userRemember:s,setUserRemember:t}=o,{colors:r}=j();return e.jsx(b,{isTrue:s,children:e.jsx("p",{className:i("text-center text-xs transition font-semibold mt-3 cursor-pointer hover:underline",r.isThemed&&r.isThemeDarkLogin?"text-red-400 hover:text-red-300":"text-red-500 hover:text-red-400"),onClick:()=>{t(null),te()},children:n("login.imNotThisUser",{user:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})})},oe=l.lazy(()=>D(()=>import("./ForgottenPasswordForm-ba431284.js"),["assets/ForgottenPasswordForm-ba431284.js","assets/index-5d060a31.js","assets/index-57a2b61b.css","assets/index-a6ad04c6.js","assets/formik.esm-d4024a5f.js","assets/index-830e2dd2.js","assets/label-4820e3e3.js","assets/translate-df1875a3.js","assets/index.esm-27ddb6fd.js"])),ie=(o,s)=>{const{userRemember:t,setUserRemember:r}=o,[T,m]=l.useState(!0),[k,c]=K(),[u,y]=l.useState(!1),N=U(h=>h.initAuthenticate),f=l.useRef(null),{formatMessage:g}=E(),{setModal:F}=P(),I=_(),A=async h=>{var x;try{const a=await w.authService.logIn(h);if((x=a.data.user)!=null&&x.roles.includes(M.ValidRoles.USER)){$.error(g({id:"login.error.isCustomer"}));return}await N(a.data),u||t?re(a.data.user):localStorage.removeItem("userRemember"),I(q.dashboard.path)}catch(a){console.log(a);let d;typeof a.response.data.message=="string"?d=a.response.data.message:Array.isArray(a.response.data.message)&&a.response.data.message[0]&&typeof a.response.data.message[0]=="string"&&(d=a.response.data.message[0]),c(d==="Credentials are not valid (password)"?g({id:"login.error.password.incorrect"}):d==="Credentials are not valid (username)"?g({id:"login.error.username.notFound"}):d==="password must be longer than or equal to 6 characters"?g({id:"login.error.password.invalidLength"}):d)}},C=()=>{F({title:g({id:"login.forgotPassword"}),children:e.jsx(l.Suspense,{fallback:e.jsx(e.Fragment,{}),children:e.jsx(oe,{defaultEmail:f.current.values.username})})})};return l.useEffect(()=>{async function h(){const x=se();if(Y(x))try{m(!0);const{data:a}=await w.usersService.getUser(x);if(!a){r(null),m(!1);return}f.current.setValues({...s,username:a==null?void 0:a.email}),r(a)}catch{r(null)}finally{m(!1)}else m(!1)}h()},[]),l.useEffect(()=>{t||f.current.setValues(s)},[t]),{loading:T,message:k,onSubmit:A,refFormik:f,checked:u,setChecked:y,forgottenPasswordFn:C}},S={username:"",password:""},ne=Q().shape({username:L().required(),password:L().required()}),le=o=>{const{userRemember:s,setUserRemember:t}=o,{colors:r}=j(),{loading:T,message:m,onSubmit:k,refFormik:c,checked:u,setChecked:y,forgottenPasswordFn:N}=ie(o,S);return e.jsx(V,{initialValues:S,validationSchema:ne,onSubmit:k,innerRef:c,children:e.jsxs(O,{children:[e.jsx(Z,{loading:T,message:m}),e.jsx(ee,{userRemember:s}),e.jsx(p,{isTrue:!s,children:e.jsx(v,{name:"username",label:n("login.username"),placeholder:n("login.placeholder.username"),showSuccess:!1,classNameInput:i(r.isThemed&&r.isThemeDarkLogin&&"bg-gray-800 text-gray-50 border-slate-700"),classNameLabel:i("text-xs",r.isThemed&&r.isThemeDarkLogin&&"text-gray-50"),showError:!1})}),e.jsx(v,{name:"password",type:"password",label:n("login.password"),placeholder:n("login.placeholder.password"),autoComplete:"off",showSuccess:!1,classNameInput:i(r.isThemed&&r.isThemeDarkLogin&&"bg-gray-800 text-gray-50 border-slate-700"),classNameLabel:i("text-xs",r.isThemed&&r.isThemeDarkLogin&&"text-gray-50"),showError:!1,className:"mb-0"}),e.jsx("p",{className:i("text-xs mt-2.5 mb-2.5",r.isThemed&&r.isThemeDarkLogin&&"text-gray-50"),children:e.jsx("button",{type:"button",onClick:N,className:"text-blue-500 hover:text-blue-400 transition font-bold hover:underline",children:n("login.forgotPassword")})}),e.jsx(p,{isTrue:!s,children:e.jsx("div",{className:"form-group",children:e.jsx(G,{classNamesCheck:i(r.isThemed&&r.isThemeDarkLogin?"bg-slate-800":"bg-gray-50"),isChecked:u,onChange:()=>y(!u),children:e.jsx("span",{className:i(r.isThemed&&r.isThemeDarkLogin&&"text-white","text-xs"),children:n("login.rememberMe")})})})}),e.jsx("div",{children:e.jsx(z,{className:"btn-primary btn-sm mb-0 mr-0",full:!0,children:n("login.signIn")})}),e.jsx(ae,{userRemember:s,setUserRemember:t})]})})},Ae=o=>{const[s,t]=R.useState(null),{colors:r}=j();return e.jsxs(B,{showLogo:!s,children:[e.jsx(b,{isTrue:!s,children:e.jsx("div",{className:"mb-3 mt-1",children:e.jsx("h6",{className:i("text-center",r.isThemed&&r.isThemeDarkLogin&&"text-gray-50"),children:n("login.welcomeBack")})})}),e.jsx(b,{isTrue:s}),e.jsx(le,{userRemember:s,setUserRemember:t})]})};export{Ae as default};
